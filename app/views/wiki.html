<!--
//
// Webble World 3.0 (IntelligentPad system for the web)
//
// Copyright (c) 2010-2015 Micke Nicander Kuwahara, Giannis Georgalis, Yuzuru Tanaka
//     in Meme Media R&D Group of Hokkaido University, Japan. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// Additional restrictions may apply. See the LICENSE file for more information.
//

-->
<!--
    - Loads and enables editing of wikis

@author Giannis Georgalis <jgeorgal@meme.hokudai.ac.jp>
-->
<div class="container-fluid closeable">

    <!-- List with the user's unpublished templates -->
    <!----------------------------------------------------------------->

    <div class="padcontent row">

        <div class="col-xs-6">

            <p ng-hide="wikis.length > 0">
                <span class="fa fa-comment"></span> <span translate>You don't have any wikis</span>
            </p>

            <div ng-show="wikis.length > 0" class="table-responsive">

                <table class="table table-striped table-condensed table-hover">

                    <thead>
                        <tr>
                            <th>#</th>

                            <th translate>Wiki</th>
                            <th translate>Name</th>
                            <th translate>Description</th>

                            <th width="130px"></th> <!-- Actions -->
                        </tr>
                    </thead>

                    <tbody>
                        <tr ng-repeat="w in wikis track by w.id" ng-click="selectWiki(w)" ng-class="{info:w.id===currWikiId}">
                            <td>{{$index + 1}}</td>
                            <td>{{w.id}}</td>
                            <td>{{w.name}}</td>
                            <td>{{w.description}}</td>

                            <td>
                                <div ng-if="w.id===currWikiId" stop-event="click" class="btn-group btn-group-xs btn-group-horizontal">
                                    <a class="btn btn-default" ng-click="openWiki(w)"><span translate>Open</span> <span class="fa fa-book"></span></a>
                                    <a class="btn btn-danger" ng-click="deleteWiki(w)"><span translate>Delete</span> <span class="fa fa-trash-o"></span></a>
                                </div>
                            </td>

                        </tr>
                    </tbody>

                </table>
            </div>
        </div>

        <div class="col-xs-6">
            <form name="shareForm" novalidate class="form-horizontal" ng-submit="addContributor(selectedContributor)" autocomplete="off" ng-required="false">

                <div class="form-group">
                    <label for="contributor" class="control-label col-xs-1" translate>User</label>

                    <div class="col-xs-3">
                        <input type="search" id="contributor" name="contributor" class="form-control formitem" ng-model="selectedContributor" placeholder="{{'Find User...'|translate}}" ng-required="false"
                               uib-typeahead="u as u.name.full for u in getUsers($viewValue) | filter:$viewValue | limitTo:20" typeahead-min-length="3" typeahead-wait-ms="200" />
                    </div>

                    <!--Selected user info-->
                    <div class="col-xs-1 optional">
                        <img width="32" src="" ng-src="{{selectedContributor.image_urls[0] || 'images/generic_avatar.png'}}" />
                    </div>

                    <div class="col-xs-6">
                        <b translate>Name:</b> <i>{{(selectedContributor.name.full || 'Not defined')|translate}}</i><br>
                        <b translate>Email:</b> <i>{{(selectedContributor.email || 'Not available')|translate}}</i><br>
                        <b translate>Username:</b> <i>{{(selectedContributor.username || 'Not defined')|translate}}</i>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-xs-offset-2 col-xs-5">
                        <button type="submit" ng-disabled="shareForm.$invalid" class="btn btn-success">
                            <span class="fa fa-plus-circle"></span> <span translate>Share</span>
                        </button>
                    </div>
                </div>

                <div ng-show="contributors.length > 0" class="table-responsive">
                    <table class="table table-striped table-condensed table-hover">

                        <thead>
                            <tr>
                                <th translate>User</th>
                                <th translate>Username</th>
                                <th translate>Email</th>

                                <th width="10%"></th> <!-- Actions -->
                            </tr>
                        </thead>

                        <tbody>
                            <tr ng-repeat="con in contributors track by $index" ng-click="selectContributor(con, $index)" ng-class="{info:$index===currConIndex}">
                                <td>#{{$index + 1}}</td>
                                <td>{{con.username}}</td>
                                <td>{{con.email}}</td>

                                <td>
                                    <div ng-if="$index===currConIndex" stop-event="click" class="btn-group btn-group-xs">
                                        <a class="btn btn-danger" ng-click="deleteContributor(con, $index)"><span translate>Delete</span> <span class="fa fa-trash-o"></span></a>
                                    </div>
                                </td>

                            </tr>
                        </tbody>

                    </table>
                </div>
            </form>
        </div>

    </div>

    <!-- Load and render the selected wiki inside an iframe -->
    <!----------------------------------------------------------------->

    <iframe ng-src="{{currWikiEmbedUrl}}" style="width:100%; height:85%; position:absolute;">Hop, hop, hop</iframe>

</div>
